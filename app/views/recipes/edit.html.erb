<% activate_nav!(:edit_recipe) %>
<%- title @page_title.to_s.html_safe %>

<%= link_to recipes_path, class: 'mam mbn flex fjc dib-ns fl-ns' do %>
  <%= inline_svg 'home.svg', class: 'fill-grey-4', size: 32 %>
<% end %>

<main class="md-col-8 mx-auto mw7 phm pvm-ns">
<%= form_for(@recipe, html: { 'data-title': @form_class }) do |f| %>

  <section class="mbm dib">
    <%= f.file_field :img, class: 'dn', 'data-behavior': 'photo_field' %>
    <div class="grey-4 pointer" data-behavior="photo_button">
      <%= inline_svg 'photo-upload.svg', size: 32, class: 'fill-grey-4 relative', style: 'top: 10px;' %>
      <span data-behavior="photo_name">
        <%= @recipe.unimaged? ? 'Upload a photo' : 'Upload a new photo' %>
      </span>
    </div>
    <% if @recipe.imaged? %>
      <div class="grey-4 pointer mts" data-behavior="remove_current_photo">
        <%= inline_svg 'close.svg', width: 32, height: 24, class: 'fill-grey-3 relative', style: 'top: 6px;' %>
        <%= link_to 'Remove current photo', recipe_remove_image_path(recipe_id: @recipe.id),
                     class: 'link-reset', data: { remote: true, behavior: 'remove_current_photo_link' } %>
      </div>
    <% end %>
  </section>

  <% if @recipe.errors.any? %>
    <section class="md-col-8 mx-auto bg-white rounded shadow tc mtm mbm pal"
             role="alertdialog" data-behavior="recipe_errors">
      <% @errors = @recipe.errors.messages %>
      <% if @errors[:img] %>
        <% if @errors[:img].last.match 'less than' %>
          <h2 class="red normal mtn">That's a big photo!</h2>
          <p class="mbn">Please use an image that's less than 2 MB.</p>
        <% end %>
        <% if @errors[:img_content_type].present? %>
          <h2 class="red normal mtn">That's not an image.</h2>
          <p class="mbn">Please pick a file that is a valid image (such as JPG/JPEG, PNG, etc).</p>
        <% end %>
      <% elsif @errors[:title] %>
        <% if @errors[:title].first.match 'blank' %>
          <h2 class="red normal mtn">Your recipe doesn't have a title!</h2>
          <p class="mbn">Add a title (below) and you'll be good to go.</p>
        <% end %>
        <% if @errors[:title].first.match 'too long' %>
          <h2 class="red normal mtn">That title is too long!</h2>
          <p class="mbn">Try shortening it (to less than 250 characters) and you'll be good to go.</p>
        <% end %>
      <% end %>
    </section>
  <% end %>

  <%= f.text_field :title, value: @title,
                   autofocus: true, required: true, autocomplete: 'off',
                   class: 'text-input invisible-input col-12 man b f1',
                   placeholder: 'Title your recipe...' %>

  <%= f.text_area :description,
                  class: 'text-input invisible-input col-12',
                  placeholder: 'If you\'d like, write a description for the recipe here.',
                  rows: '1', autocomplete: 'off', 'data-behavior': 'autosize' %>

  <%= f.label :ingredients, class: 'dib f3' %><small class="f5 mls grey-4">Put one on each line.</small>
  <%= f.text_area :ingredients,
                  class: 'text-input invisible-input col-12 man',
                  placeholder: 'Click here and type your recipe\'s ingredients.',
                  rows: '3', autocomplete: 'off', 'data-behavior': 'autosize' %>

  <%= f.label :instructions, class: 'dib f3' %><small class="f5 mls grey-4">Fully supports Markdown.</small>
  <%= f.text_area :instructions,
                  class: 'text-input invisible-input col-12 man',
                  placeholder: 'Add the instructions here.',
                  rows: '4', autocomplete: 'off',
                  'data-behavior': 'autosize editor_instructions' %>

  <section>
    <h2 class="mtn">Details</h2>

    <%= f.label :source, class: 'dib' %><small class="f5 mls grey-4">Where did this recipe come from?</small>
    <%= f.text_field :source, class: 'text-input md-col-8' %>

    <%= f.label :author, class: 'dib' %><small class="f5 mls grey-4">Who originally wrote this recipe?</small>
    <%= f.text_field :author, class: 'text-input md-col-8' %>

    <%= f.label :serves, 'Yield', class: 'dib' %><small class="f5 mls grey-4">How many servings does your recipe produce?</small>
    <%= f.text_field :serves, class: 'text-input md-col-8' %>
  </section>

  <%= f.submit 'Save', class: 'btn bg-blue b mtl mbl', 'data-disable-with': 'Saving...' %>

<% end %>
</main>
