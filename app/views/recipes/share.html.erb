<%- title @recipe.title.html_safe %>
<% activate_nav!(:recipes) %>
<% activate_nav!(:shared_recipe) %>

<% content_for :meta do -%>
  <% if @recipe.img.url.present? %>
    <meta name="twitter:card" content="summary_large_image">
    <meta property="og:image" content="<%= @recipe.img.url %>"/>
    <meta name="twitter:image" content="<%= @recipe.img.url %>">
  <% else %>
    <meta name="twitter:card" content="summary">
  <% end %>
  <meta property="og:site_name" content="Noodles" />
  <meta property="og:url" content="<%= @shared_url %>">
  <meta property="og:title" content="<%= @recipe.title %>">
  <meta name="twitter:title" content="<%= @recipe.title %>">
  <% if @recipe.description.blank? %>
    <% @description = "Check out this recipe published on Noodles by #{@recipe.user.first_name}." %>
    <meta property="og:description" content="<%= @description %>">
    <meta property="twitter:description" content="<%= @description %>">
  <% else %>
    <meta property="og:description" content="<%= @recipe.description %> — Published on Noodles">
    <meta name="twitter:description" content="<%= @recipe.description %> — Published on Noodles">
    <meta name="description" content="<%= @recipe.description %> — Published on Noodles">
  <% end %>
<% end -%>

<%= render 'shared/nav' %>

<div itemscope itemtype="http://schema.org/Recipe">
  <meta itemprop="url" content="<%= @shared_url %>" />
  <meta itemprop="dateCreated" content="<%= @recipe.created_at %>" />
  <meta itemprop="dateModified" content="<%= @recipe.updated_at %>" />

  <%= render 'image_header' if @image_layout %>

  <main class="document mw7">

    <% if !@image_layout %>
      <h1 class="man" itemprop="name"><%= @recipe.title %></h1>
      <% if @recipe.user.present? %>
      <p class="grey-3">Shared by <%= @recipe.user.first_name %></p>
      <% end %>
      <div class="text" itemprop="description"><%= sanitize markdown(@recipe.description.to_s) %></div>
    <% end %>

    <%= render 'recipe_body' %>

    <%= render 'shared/social' if me_owns_recipe? %>

    <% if me_owns_recipe? %>
    <%# If it's your recipe, hint about saving %>
      <div class="mtm dn-p">
        <a class="btn bg-orange mrs" title="Others can click this button to save a copy of your recipe to their Noodles account." disabled>Save to my Noodles</a>
        <%= link_to 'Un-share', recipe_un_share_path(@recipe), class: 'btn bg-red mrs' %>
      </div>
    <% elsif user_signed_in? %>
    <%# If you're logged in, show Save button %>
      <div class="mtm dn-p">
        <%= link_to 'Save to my Noodles', :save_to_noodles, title: 'Save a copy of this recipe to your own account', class: 'btn bg-orange mrs' %>
      </div>
    <% else %>
    <%# Everyone else should sign up for Noodles %>
      <%= render 'shared/interested_in_noodles' %>
    <% end %>

  </main>

</div>

<a class="btn-paper-mini bg-orange fill-white circle fixed pas pointer shadow" data-behavior="print">
  <%= inline_svg 'print.svg' %>
</a>

<%= link_to public_cook_path(@recipe.shared_id), class: 'btn-paper bg-orange fill-white circle fixed pam shadow', rel: 'nofollow' do %>
  <%= inline_svg 'cook.svg' %>
<% end %>
