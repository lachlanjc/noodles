<%- title @recipe.title.html_safe %>
<% activate_nav!(:recipes) %>
<% activate_nav!(:shared_recipe) %>

<% content_for :meta do -%>
  <% if @recipe.img.url.present? %>
    <meta name="twitter:card" content="summary_large_image">
    <meta property="og:image" content="<%= @recipe.img.url %>"/>
    <meta name="twitter:image" content="<%= @recipe.img.url %>">
  <% else %>
    <meta name="twitter:card" content="summary">
  <% end %>
  <meta property="og:site_name" content="Noodles" />
  <meta property="og:url" content="<%= @shared_url %>">
  <meta property="og:title" content="<%= @recipe.title %>">
  <meta name="twitter:title" content="<%= @recipe.title %>">
  <% if @recipe.description.blank? %>
    <% @description = "Check out this recipe published on Noodles by #{@recipe.user.first_name}." %>
    <meta property="og:description" content="<%= @description %>">
    <meta property="twitter:description" content="<%= @description %>">
  <% else %>
    <meta property="og:description" content="<%= @recipe.description %> â€” Published on Noodles">
    <meta name="twitter:description" content="<%= @recipe.description %> â€” Published on Noodles">
    <meta name="description" content="<%= @recipe.description %> â€” Published on Noodles">
  <% end %>
<% end -%>

<%= render 'shared/nav' %>

<div itemscope itemtype="http://schema.org/Recipe">
  <meta itemprop="url" content="<%= @shared_url %>" />
  <meta itemprop="dateCreated" content="<%= @recipe.created_at %>" />
  <meta itemprop="dateModified" content="<%= @recipe.updated_at %>" />

  <% if @image_layout %>
    <header class="image-header inline-with-nav relative bg-cover bg-center flex-ns fac pam"
            style="background-image: url(<%= @recipe.img.url %>); min-height: 25vh;">

      <div class="md-col-8 mx-auto mw7">
        <h1 class="white mbs h0" itemprop="name"><%= @recipe.title %></h1>

        <% if @recipe.description.present? %>
        <div class="white" itemprop="description">
          <%= whitened_markdown @recipe.description %>
        </div>
        <% end %>

        <% if @recipe.user.present? %>
        <p class="white f5 mtm">Shared by <%= @recipe.user.first_name %></p>
        <% end %>
      </div>

      <a href="#photo" name="photo mrs flex-last pointer" data-behavior="modal_trigger">
        <%= inline_svg 'fullscreen.svg', class: 'fill-white' %>
      </a>
    </header>

    <section id="photo" role="dialog" class="modal">
      <div class="pointer absolute pas" style="right: 1rem;" data-behavior="modal_close">
        <%= inline_svg 'close.svg', class: 'fill-white',
                       style: '-webkit-filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.25));
                                       filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.25));' %>
      </div>
      <%= image_tag @recipe.img, class: 'col-12', itemprop: 'image' %>
    </section>

    <%= render 'shared/flash' %>

  <% end %>

  <main class="document mw7">

    <% if !@image_layout %>
      <h1 class="man" itemprop="name"><%= @recipe.title %></h1>
      <% if @recipe.user.present? %>
      <p class="grey-3">Shared by <%= @recipe.user.first_name %></p>
      <% end %>
      <div class="text" itemprop="description"><%= sanitize markdown(@recipe.description.to_s) %></div>
    <% end %>

    <%= render 'recipe_body' %>

    <%= render 'shared/social' if me_owns_recipe? %>

    <% if me_owns_recipe? %>
    <%# If it's your recipe, hint about saving %>
      <div class="mtm dn-p">
        <a class="btn bg-orange mrs" title="Others can click this button to save a copy of your recipe to their Noodles account." disabled>Save</a>
        <%= link_to 'Un-share', recipe_un_share_path(@recipe), class: 'btn bg-red mrs' %>
      </div>
    <% elsif user_signed_in? %>
    <%# If you're logged in, show Save button %>
      <div class="mtm dn-p">
        <%= link_to 'Save', :save_to_noodles, title: 'Save a copy of this recipe to your own account', class: 'btn bg-orange mrs' %>
      </div>
    <% else %>
    <%# Everyone else should sign up for Noodles %>
      <%= render 'shared/interested_in_noodles' %>
    <% end %>

  </main>

</div>

<a class="btn-paper-mini bg-orange fill-white circle fixed pas pointer shadow" data-behavior="print">
  <%= inline_svg 'print.svg' %>
</a>

<%= link_to public_cook_path(@recipe.shared_id), class: 'btn-paper bg-orange fill-white circle fixed pam shadow', rel: 'nofollow' do %>
  <%= inline_svg 'cook.svg' %>
<% end %>
