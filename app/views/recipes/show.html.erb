<%- title @recipe.title %>
<% activate_nav!(:recipe) %>

<%= render "shared/nav" %>

<article class="document recipe-print">

  <%= form_for(@recipe, remote: true, html: { id: "recipeFavoriteForm" }) do |f| %>
    <label class="control header-indicator m0">
      <%= f.check_box :favorite, class: "control-checkbox", id: "recipeFavoriteTrigger" %>
      <div class="control-indicator">
        <%= inline_svg("favorite_outline.svg") %>
      </div>
      <div class="control-indicator-checked">
        <%= inline_svg("favorite.svg") %>
      </div>
    </label>
  <% end %>

  <div itemscope itemtype="http://schema.org/Recipe">
    <meta itemprop="url" content="<%= @shared_url %>" />
    <meta itemprop="dateCreated" content="<%= @recipe.created_at %>" />
    <meta itemprop="dateModified" content="<%= @recipe.updated_at %>" />

    <h1 class="m0 inline" itemprop="name"><%= @recipe.title %></h1>
    <div class="text mt2" itemprop="description"><%= markdown(@recipe.description.to_s) %></div>

    <%= render "recipe_body", cache: true %>
  </div>

  <%= render "shared/social" if @recipe.shared? %>

  <div class="print-hide mt2 mb1">
    <%= link_to t("general.edit"), :edit_recipe, class: "btn-blue mobile-button mr1" %>
    <a id="collectModalTrigger" href="#collectModal" class="btn mobile-button mr1">Add to Collection</a>
    <a id="shareModalTrigger" href="#shareModal" class="btn-green mobile-button mr1">Share</a>
    <a id="printRecipe" class="btn-blue mobile-button mr1">Print</a>
  </div>

  <%= render "shared/printer" %>

</article>

<div id="collectModal" class="modal">
  <%= react_component("ModalClose") %>

  <h2>Add to Collection</h2>
  <hr>
  <% @collections = Collection.where(:user_id => current_user) %>

  <% if @collections.any? %>
    <% if @recipe.collections.length <= 4 %>
    <p>Add this recipe to your collections by clicking them from the list below.</p>
    <% else %>
    <p>"<%= @recipe.title %>" is already in <%= pluralize(@recipe.collections.reject!(&:blank?).length, "collection") %>. To add it to additional collections, click on them in the list below.</p>
    <% end %>

    <%= form_for(@recipe) do |f| %>
      <ul class="list-reset sm-col-10 md-col-5 mx-auto">
        <%= collection_check_boxes(:recipe, :collections, @collections, :id, :name) do |b| %>
        <li class="border-top">
          <%= b.label(class: "collection-list-item m0 p1") do %>
            <% if @recipe.collections.include?(b.value.to_s) %>
            <%= b.check_box(checked: "checked", class: "hide") %>
            <% else %>
            <%= b.check_box(class: "hide") %>
            <% end %>
            <%= content_tag(:span, b.text) %>
            <div class="checkmark fill-orange right hide">
              <%= inline_svg("check.svg") %>
            </div>
          <% end %>
        </li>
        <% end %>
        <li class="border-top border-bottom p1 grey-1">
          <%= link_to "Add a New Collection...", collections_path(:new_collection => true), class: "link-reset" %>
        </li>
      </ul>
      <%= f.submit "Save", class: "btn-blue right" %>
    <% end %>
  <% else %>
    <div class="well text center bg-grey-6 border rounded py3 px2">
      You don't have any collections yet. Why don't you <%= link_to "create one", collections_path(:new_collection => true), class: "blue" %>?
    </div>
  <% end %>
</div>

<div id="shareModal" class="modal">
  <%= react_component("ModalClose") %>

  <h2>Share this recipe</h2>
  <hr>

  <div class="tab-container">

    <input type="radio" name="tab-set-2" class="tab-1" id="tab-2-1" checked>
    <label for="tab-2-1">Share a link</label>

    <input type="radio" name="tab-set-2" class="tab-2" id="tab-2-2">
    <label for="tab-2-2">Download a PDF</label>

    <input type="radio" name="tab-set-2" class="tab-3" id="tab-2-3">
    <label for="tab-2-3">Embed on the Web</label>

    <br>

    <div class="content content-1">
      <% if @recipe.shared? %>
      <p>Your recipe is already shared!</p>
      <p><%= link_to "Check it out", @shared_url, class: "btn-blue" %></p>
      <% else %>
      <p>Anyone with this link can see your recipe and save a copy to their own Noodles account.</p>
      <p><%= link_to "Share this recipe", recipe_share_it_path(@recipe), class: "btn-blue" %></p>
      <% end %>
    </div>

    <div class="content content-2">
      <p>Click the button below to download a PDF of your recipe.</p>
      <p><%= link_to "Download PDF", recipe_export_pdf_path(@recipe), class: "btn-blue" %></p>
    </div>

    <div class="content content-3">
      <p>Copy and paste the code below onto your website or blog to embed this recipe.</p>
      <pre class="m0 p1 border rounded bg-grey-6 text"><%= @embed_code %></pre>
      <p class="mt1"><%= link_to "Need help?", help_path %></p>
    </div>

  </div>

</div>

<%= link_to recipe_cook_path(:recipe_id => @recipe.id), class: "btn-paper has-tooltip", data: { tooltip: "Open Cook Mode" } do %>
  <%= inline_svg("cook.svg") %>
<% end %>
