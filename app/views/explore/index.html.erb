<% activate_nav!(:explore) %>
<% title 'Explore' %>

<%= render 'shared/nav' %>

<header class="center relative inline-with-nav image-header bg-center bg-no-repeat bg-cover pvxl phm"
        style='background-image: url(<%= image_path "explore/#{rand(1..5).to_s}.jpg" %>);'>
  <h1 class="mt0 mb0 white">Explore</h1>
  <h2 class="white regular mt1 mb2">What do you want to make?</h2>
  <div class="md-col-8 mw7 phs mx-auto flex fac">
    <input type="text" role="search"
           class="text-input col-12 dib f2 shadow pvs phm bw0 bs-bb"
           placeholder="maybe pancakes?"
           data-behavior="explore_search_field">
    <a class="pointer" data-behavior="explore_clear_search">
      <%= inline_svg 'close.svg', class: 'fill-white ml1 dib' %>
    </a>
  </div>
  <section role="menubar" class="filterbar mt2" data-behavior="explore_src_pick_bar">
    <a role="menuitem" class="filterbar-item inline-block phm pointer white white-hover"
       data-behavior="explore_src_pick" data-src-name="nyt">NYT Cooking</a>
   <a role="menuitem" class="filterbar-item inline-block phm pointer white white-hover"
       data-behavior="explore_src_pick" data-src-name="epicurious">Epicurious</a>
   <a role="menuitem" class="filterbar-item inline-block phm pointer white white-hover"
       data-behavior="explore_src_pick" data-src-name="allrecipes">Allrecipes</a>
  </section>
</header>

<main class="md-col-8 mx-auto pam center mw7" data-behavior="explore_results_container">
  <h2 class="mt0 normal">
    This is <span class="bold">Explore</span> by <%= link_to 'Noodles', root_url, class: 'bold' %>.
    Find amazing new recipes.
  </h2>
  <% if user_signed_in? %>
    <p>
      Search for anything you want to cook &mdash;
      you can save them to your Noodles with just a click.
    </p>
  <% else %>
    <p>
      Search for anything you want to cook to get started. Sign up for Noodles to save the recipe.
    </p>
    <a href="#signup" name="signup" data-behavior="modal_trigger inline_signup_btn" class="btn bg-orange mt1">Sign up for Noodles</a>
  <% end %>
</main>

<h2 class="phm mx-auto mw7 normal center m0" data-behavior="explore_suggestions">
  Granola? Carrot cake? Sorbet? Risotto? Stir fry?
  <br>ðŸ˜‹
</h2>

<% if nobody_signed_in? %>
  <section class="modal" role="dialog" id="signup">
    <%= modal_close %>
    <h2 class="orange mb0">Sign up for Noodles</h2>
    <%= render 'devise/registrations/new', user: User.new, text: 'Noodles is, and always will be, totally free.',
                                           params: { explore: true },
                                           options: { class: 'modal-scroll', data: { remote: true, behavior: 'inline_signup_form' } } %>
  </section>
<% end %>

<section class="modal pam" role="dialog" id="preview" data-behavior="explore_preview_modal">
  <%= modal_close %>
  <h2 class="orange inline mb0" data-behavior="explore_preview_title"></h2>
  <a data-behavior="explore_open_original" class="inline-block" target="_blank">
    <%= inline_svg 'open-new-tab.svg', class: 'fill-orange relative', style: 'width: 16px; height: 16px; top: -5px; left: 2px;' %>
  </a>
  <p class="grey-3" data-behavior="explore_preview_description"></p>
  <article class="text modal-scroll" data-behavior="explore_preview_body"></article>
  <footer class="border-top center blue">
    <% if user_signed_in? %>
      <a class="btn bg-blue mt2" data-behavior="explore_clip_from_preview">Clip</a>
    <% else %>
      <%= link_to 'Sign up for Noodles to Clip', sign_up_path, class: 'btn bg-orange mt2' %>
    <% end %>
  </footer>
</section>

<script>
var urlParams;
(window.onpopstate = function() {
	var match,
		pl = /\+/g, // Regex for replacing addition symbol with a space
		search = /([^&=]+)=?([^&]*)/g,
		decode = function(s) {
			return decodeURIComponent(s.replace(pl, " "));
		},
		query = window.location.search.substring(1);

	urlParams = {};
	while (match = search.exec(query))
		urlParams[decode(match[1])] = decode(match[2]);
})();
</script>
<%= javascript_include_tag 'explore' %>
