<% activate_nav!(:explore) %>
<%- title 'Explore' %>

<% content_for :meta do -%>
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary">
  <meta property="og:site_name" content="Noodles">
  <meta name="twitter:site" content="@noodlesapp">
  <meta name="twitter:domain" content="getnoodl.es">
  <meta property="og:url" content="<%= explore_url %>">
  <meta property="og:title" content="Noodles Explore">
  <meta name="twitter:title" content="Noodles Explore">
  <meta property="og:description" content="Find the best recipes on the web with Noodles Explore.">
  <meta name="twitter:description" content="Find the best recipes on the web with Noodles Explore.">
<% end -%>

<%= render 'shared/nav' %>

<header
  class="relative inline-with-nav image-header bg-center bg-no-repeat bg-cover pvxl phm flex fac"
  style='background-image: url(<%= image_path "explore/#{rand(1..6).to_s}.jpg" %>);'>
  <div class="tc mx-auto col-12">
    <%= link_to root_url, class: 'link-reset' do %>
      <h1 class="mvn white">
        Noodles Explore
      </h1>
    <% end %>
    <h2 class="white sans fwn mts mbm">What do you want to make?</h2>
    <div class="md-col-8 mw7 phs mx-auto flex fac">
      <input
        type="text"
        role="search"
        class="text-input col-12 dib f2 rounded card pvs phm bw0 bx"
        placeholder="maybe pancakes?"
        data-behavior="explore_search_field"
        autofocus
      />
      <a class="pointer dn" data-behavior="explore_clear_search rehide">
        <%= inline_svg 'close.svg', class: 'fill-white mls dib' %>
      </a>
    </div>
    <section role="menubar" class="filterbar mtm" data-behavior="explore_src_pick_bar">
      <a role="menuitem" class="filterbar__item dib phm pointer white white-hover"
         data-behavior="explore_src_pick" data-src-name="nyt">NYT Cooking</a>
      <a role="menuitem" class="filterbar__item dib phm pointer white white-hover"
         data-behavior="explore_src_pick" data-src-name="epicurious">Epicurious</a>
      <a role="menuitem" class="filterbar__item dib phm pointer white white-hover"
         data-behavior="explore_src_pick" data-src-name="allrecipes">Allrecipes</a>
    </section>
  </div>
</header>

<main class="md-col-10 mx-auto pam tc mw7" data-behavior="explore_results_container">
  <article class="col-12 rounded bg-white shadow pal bx mx-auto mw6">
    <div class="md-col-10 mx-auto pam-ns">
    <h2 class="mtn fwn">
      Find the best recipes on the web with <span class="b">Explore</span>.
    </h2>
    <% if user_signed_in? %>
      <p class="mbn">
        Search for anything you want to cook,
        then save your favorite results to your library.
      </p>
    <% else %>
      <p>
        Search for anything you want to cook.
        <br class="dn db-ns">
        Sign up to save the recipes you find.
      </p>
      <div class="tc mts" data-behavior="inline_signup_btn_container">
        <a href="#signup" name="signup" data-behavior="modal_trigger inline_signup_btn" class="btn bg-orange">Sign up for Noodles</a>
        <%= link_to 'Sign back in', sign_in_path, class: 'mls-ns mts btn bg-white' %>
      </div>
    <% end %>
    </div>
  </article>
</main>

<h2 class="phm mx-auto mw7 normal flex fac fjc mtn" data-behavior="explore_suggestions rehide">
  <span class="f0 mrm">ðŸ˜‹</span>
  <span>
    Carrot cake? Gelato?<br>
    Mochi? Kebabs?<br>
    Spring rolls? Lamb curry?
  </span>
</h2>

<% if nobody_signed_in? %>
  <section class="modal modal--scrollable pal-ns" role="dialog" id="signup">
    <%= modal_header 'Sign up for Noodles' %>
    <%= render 'devise/registrations/new',
      user: User.new,
      options: { class: 'modal__scroller col-12' }
    %>
    <div class="dn" data-behavior="inline_signup_error">
      <h3 class="red fwn mbm">Something went wrong. ðŸ˜ž</h3>
      <%= link_to 'Try Again', sign_up_path, class: 'btn btn--primary bg-blue' %>
    </div>
  </section>
<% end %>

<section class="modal modal--scrollable modal--mw phl-ns" role="dialog" id="preview" data-behavior="explore_preview_modal">
  <action class="pointer absolute r0 mrm mrl-ns mts mtm-ns" data-behavior="modal_close">
    <%= inline_svg 'close.svg', size: 28, class: 'fill-grey-3' %>
  </action>
  <header class="mtm-ns mbm">
    <h2 class="orange mvn dtc" data-behavior="explore_preview_title"></h2>
    <a data-behavior="explore_open_original" class="dtc v-top phs" target="_blank" rel="nofollow">
      <%= inline_svg 'open-new-tab.svg', class: 'fill-orange', size: 16 %>
    </a>
    <p class="grey-4 mbn" data-behavior="explore_preview_description"></p>
  </header>
  <article class="text modal__scroller" data-behavior="explore_preview_body"></article>
  <footer class="modal__footer">
    <% if user_signed_in? %>
      <a
        data-behavior="explore_clip_from_preview explore_clipped_toggle"
        style="max-width: 28px;">
        Clip
      </a>
      <a
        class="blue"
        target="_blank"
        data-behavior="rehide explore_clipped_open explore_clipped_toggle">
        Clipped â€“ <strong>Open</strong>
        <%= inline_svg 'open-new-tab.svg', size: 16, class: 'fill-blue' %>
      </a>
    <% else %>
      <a data-behavior="modal_trigger modal_close_first" href="#signup" class="btn btn--primary bg-orange">Sign up</a>
      <span class="grey-3 dib mlm">before you Clip</a>
    <% end %>
  </footer>
</section>

<script>
var urlParams;
(window.onpopstate = function() {
	var match,
		pl = /\+/g, // Regex for replacing addition symbol with a space
		search = /([^&=]+)=?([^&]*)/g,
		decode = function(s) {
			return decodeURIComponent(s.replace(pl, ' '));
		},
		query = window.location.search.substring(1);

	urlParams = {};
	while (match = search.exec(query))
		urlParams[decode(match[1])] = decode(match[2]);
})();
</script>
<%= javascript_include_tag 'explore' %>
