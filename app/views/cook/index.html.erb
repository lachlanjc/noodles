<%- title "Cooking " + @recipe.title %>
<%= stylesheet_link_tag "cook" %>

<main class="md-flex">

  <aside class="sm-col-11 md-col-4 m2">
    <h1 class="m0 grey-1"><%= @recipe.title %></h2>
    <p class="grey-3 m0">
      <%= pluralize(@recipe.instructions.lines.count, "steps") %>
      <% if not_my_recipe? %>
        <span> · </span>
        <a class="grey-2" href="<%= shared_url(@recipe) %>">Published by <%= User.find(@recipe.user_id).first_name %></a>
      <% else %>
        <span> · </span>
        <%= link_to "Edit recipe", edit_recipe_url(@recipe), class: "grey-2" %>
      <% end %>
    </p>

    <hr class="col-10">

    <%= react_component("IngredientsChecklist", ingredients: @recipe.ingredients.split("\n")) %>

    <hr class="col-10">

    <% if me_owns_recipe? %>
      <%= react_component("NoteEditor", recipe_id: @recipe.id) %>
    <% else %>
      <div class="rounded border shadow p2 bg-white text text-normalized">
        <% if @recipe.notes.blank? %>
        <p class="grey-4 mb0">No notes for this recipe &mdash; yet!</p>
        <% else %>
        <%= sanitize markdown(@recipe.notes) %>
        <% end %>
      </div>
    <% end %>
  </aside>

  <article class="sm-col-11 md-col-6 mx-auto mt2 p0">
    <%= react_component("CookInstructions", instructions: @recipe.instructions.split("\n")) %>

    <div class="bg-white rounded shadow p2 block h2 center mb2 grey-2">
      <span>And now you're finished! Enjoy the <%= @recipe.title %>.</span>

      <%= image_tag @recipe.img, alt: "Photo of " + @recipe.title, class: "mt2 mx-auto rounded" if @recipe.img.present? %>

      <%= form_for(@recipe, url: recipe_path(@recipe, cook: true), html: { class: "mt2 pointer block h4"}) do |f| %>
        <%= f.file_field :img, class: "hide", data: { behavior: "photo_field cook_photo_field" } %>
        <div class="grey-4 inline-block" data-behavior="photo_button">
          <%= react_component("IconPhoto", size: "32px", classes: "fill-grey-4") %>
          <span class="up-10 underline" data-behavior="photo_name">
            <%= @recipe.img.url.blank? ? "Add a photo to your recipe" : "Upload a new photo" %>
          </span>
          <% if @recipe.img.url.present? %>
            <span class="up-10">or</span>
            <%= link_to("remove this photo", recipe_remove_image_path(@recipe, cook: true), class: "link-reset up-10 underline") %>
          <% end %>
        </div>
      <% end %>
    </div>
  </article>

</main>

<%= link_to @exit_link, class: "btn-paper bg-orange fill-white circle fixed p2 shadow" do %>
  <%= inline_svg("exit.svg") %>
<% end %>
